%% mh_basic -- basic tex setup file with XeTeX/LuaTeX support.
%% Copyright 2013 by Michael Helmling
%% Newest version: github.com/supermihi/latex
%%
%% Feel free to use and modify to your wish!
\RequirePackage{expl3,l3keys2e,l3keys,xparse}
\NeedsTeXFormat{LaTeX2e}
\ProvidesExplPackage
  {mh_basic}
  {2013/11/06}
  {2}
  {basic TeX setup file for UTF-8 encoded files with pdf-/Xe-/LuaLaTeX support}
  
\keys_define:nn { mhbasic } {
  german       .code:n = {\tl_set:Nn \mhlang {german}},
  english      .code:n = {\tl_set:Nn \mhlang {english}},

  babel        .bool_set:N  = \l_mhbasic_babel,
  babel        .initial:n   = true,
  
  fonts        .bool_set:N  = \l_mhbasic_myfonts,
  fonts        .initial:n   = false,
  
  math         .bool_set:N  = \l_mhbasic_math,
  math         .initial:n   = false,
  
  prettyref    .bool_set:N  = \l_mhbasic_prettyref,
  prettyref    .initial:n   = false,
}

\ProcessKeysOptions { mhbasic }

\bool_if:NTF
  \l_mhbasic_math
  {\ExplSyntaxOff\RequirePackage{mh_math}\ExplSyntaxOn}
  {}

\pdftex_if_engine:TF
  {
    \RequirePackage[utf8]{inputenc}
    \RequirePackage[T1]{fontenc}
    \bool_if:NTF
      \l_mhbasic_myfonts
      {
        \RequirePackage{libertine}
        \RequirePackage{inconsolata}
      }
      {\RequirePackage{lmodern}}
    \bool_if:NTF
      \l_mhbasic_babel
      {
        \str_if_eq:VnTF
          \mhlang
          {english}
          {\RequirePackage[english]{babel}}
          {\RequirePackage[ngerman]{babel}}
      }
      {  }
  }
  {
    \RequirePackage{fontspec}
    \defaultfontfeatures{Ligatures=TeX}
    \bool_if:NTF
      \l_mhbasic_myfonts
      {
        \setromanfont[Numbers=Proportional]{Linux~Libertine~O}
        \setsansfont[Numbers=Proportional]{Linux~Biolinum~O}
        \setmonofont{Inconsolata}
      }
      {  }
    \bool_if:NTF
      \l_mhbasic_babel
      {
        \RequirePackage[babelshorthands]{polyglossia}
        \ExplSyntaxOff\setmainlanguage{\mhlang}\ExplSyntaxOn
      }
      {  }
  }

\RequirePackage{csquotes}
\RequirePackage{microtype}
\RequirePackage[newcommands]{ragged2e}
\RequirePackage{xspace}

% common abbreviations
\DeclareDocumentCommand
  {\emphex}
  { m }
  {\emph{#1}\index{#1}}

\str_if_eq:VnTF
  \mhlang
  {german}
  {\DeclareDocumentCommand{\zB}{}{\text{z.\,B.}\xspace}}
  {
    \DeclareDocumentCommand{\st}  { } {\text{s.\,t.} \xspace}
    \DeclareDocumentCommand{\ie}  { } {\text{i.\,e.} \xspace}
    \DeclareDocumentCommand{\eg}  { } {\text{e.\,g.} \xspace}
    \DeclareDocumentCommand{\wrt} { } {\text{wrt.}   \xspace}
  }

\bool_if:NTF
  \l_mhbasic_prettyref
  {
    % reference formats
    \RequirePackage{prettyref}
    \newrefformat{eq}{\textup{(\ref{#1})}}
    \newrefformat{def}{Definition~\ref{#1}}
    \newrefformat{lemma}{Lemma~\ref{#1}}
    \str_if_eq:VnTF
      \mhlang
      {german}
      {
        \newrefformat{alg}{Algorithmus~\ref{#1}}
        \newrefformat{fig}{Abbildung~\ref{#1}}
        \newrefformat{rem}{Bemerkung~\ref{#1}}
        \newrefformat{example}{Beispiel~\ref{#1}}
        \newrefformat{chapter}{Kapitel~\ref{#1}}
        \newrefformat{sec}{Abschnitt~\ref{#1}}
        \newrefformat{thm}{Satz~\ref{#1}}
        \newrefformat{obs}{Beobachtung~\ref{#1}}
        \newrefformat{cor}{Korollar~\ref{#1}}
        \newrefformat{line}{Zeile~\ref{#1}}
        \newrefformat{table}{Tabelle~\ref{#1}}
      }
      {
        \newrefformat{alg}{Algorithm~\ref{#1}}
        \newrefformat{fig}{Figure~\ref{#1}}
        \newrefformat{rem}{Remark~\ref{#1}}
        \newrefformat{example}{Example~\ref{#1}}
        \newrefformat{chapter}{Chapter~\ref{#1}}
        \newrefformat{sec}{Section~\ref{#1}}
        \newrefformat{thm}{Theorem~\ref{#1}}
        \newrefformat{obs}{Observation~\ref{#1}}
        \newrefformat{cor}{Corollary~\ref{#1}}
        \newrefformat{line}{Line~\ref{#1}}
        \newrefformat{table}{Table~\ref{#1}}
      }
  }
  {  }
