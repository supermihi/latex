% !TeX encoding = UTF-8
\NeedsTeXFormat{LaTeX2e}[2011/06/27]
\RequirePackage{expl3,xparse}
\ProvidesExplPackage{mhex}{2013/09/26}{0.1}{Create Exercises}

\RequirePackage{etoolbox}
\RequirePackage{xspace}
\RequirePackage[inline]{enumitem}
\setlist[enumerate,1]{label=\alph*)}
\setlist[enumerate,2]{label=\arabic*.}


\cs_new:Nn \l_mhex_exheader:n {
  \par\vspace{2.5mm}
  \noindent{\textbf{#1}}
  \par\vspace{1.5mm}
}

\keys_define:nn { mhexerciseenv } {
  points .tl_set:N = \l_mhex_curexpoints,
  points .value_required:,
  title  .tl_set:N = \l_mhex_curextitle,
  title  .value_required: ,
}
\newcounter{mhexercise}
\defcounter{mhexercise}{0}
\DeclareDocumentEnvironment
  {exercise}
  {o}
  {
    \keys_set:nn {mhexerciseenv} {points=,title=,}
    \IfValueTF
      {#1}
      {\keys_set:nn {mhexerciseenv} {#1}}
      { }
    \refstepcounter{mhexercise}
    \l_mhex_exheader:n
      {
        \l_mhex_exercisetext{}~
        \tl_if_empty:NTF \l_mhex_sheetno     {} {\l_mhex_sheetno.}
        \arabic{mhexercise}
        \tl_if_empty:NTF \l_mhex_curextitle  {} {~\textendash{}~\l_mhex_curextitle}
        \tl_if_empty:NTF \l_mhex_curexpoints {} {~(\l_mhex_curexpoints{}~\l_mhex_pointstext)}
      }
  }
  {\par\vspace{2mm}}

\DeclareDocumentEnvironment
  {solution}
  {o}
  {}
  {}
%\DeclareDocumentEnvironment{subexercises}{o}

\keys_define:nn { mhex } {
  sheetnumber .tl_set:N = \l_mhex_sheetno,
  solution .choice:,
  solution / yes  .code:n    = {\bool_set_true:N  \l_mhex_solution
                                \bool_set_false:N \l_mhex_solution_auto},
  solution / no   .code:n    = {\bool_set_false:N \l_mhex_solution
                                \bool_set_false:N \l_mhex_solution_auto},
  solution / auto .code:n    = {\bool_set_true:N  \l_mhex_solution_auto},
  solution        .default:n = yes,
}

\keys_set:nn { mhex } {
  sheetnumber = 1,
  solution    = auto,
}
\bool_new:N \l_mhex_solution

\cs_new:Npn \ExerciseSetup #1 {
  \keys_set:nn { mhex } { #1 }
  \bool_if:NTF
    \l_mhex_solution_auto
    {
      \PackageWarning{mhex}{\l_mhex_solutionfilename}
      \tl_if_in:nnTF
        {\jobname}
        {\l_mhex_solutionfilename}
        {\bool_set_true:N  \l_mhex_solution}
        {\bool_set_false:N \l_mhex_solution}
    }
    {\PackageWarning{mhex}{\l_mhex_solution_option}}
}


\cs_new:Nn \mhex_loadenglishcaptions: {
  \tl_set:Nn \l_mhex_exercisetext { Exercise }
  \tl_set:Nn \l_mhex_solutiontext { Solution }
  \tl_set:Nn \l_mhex_pointstext   { points }
  \tl_set:Nn \l_mhex_solutionfilename { olution }
}
\cs_new:Nn \mhex_loadgermancaptions: {
  \tl_set:Nn \l_mhex_exercisetext { Übung }
  \tl_set:Nn \l_mhex_solutiontext { Lösung }
  \tl_set:Nn \l_mhex_pointstext   { Punkte }
  \tl_set:Nn \l_mhex_solutionfilename { oesung }
}
\mhex_loadgermancaptions:
\ProcessOptions\relax
